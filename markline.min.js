!function(t,e){function n(t,e,n,i){return Math.atan2(i-e,n-t)}function i(t,e,n,i,o,a,s){var h=o/2,r=a/2;t.save(),t.translate(e,n),t.rotate(i),t.translate(-h,-r),t.beginPath(),t.moveTo(0,0),t.lineTo(h,r),t.lineTo(0,a),t.strokeStyle=s,t.stroke(),t.restore()}function o(t,e,n,i){var o,a,s,h;return a=(t+n)/2,s=(e+i)/2,h=.2*Math.sqrt(Math.pow(i-e,2)+Math.pow(n-t,2)),o=Math.atan2(i-e,n-t),{x:a-h*Math.sin(o),y:s+h*Math.cos(o)}}function a(){if(""!=A){var t=document.getElementById(A);x.drawImage(t,I.x,I.y,f,d)}else x.drawImage(X,I.x,I.y,f,d)}function s(t){for(var e=0;t>e;e++)m[e].paint(3)}function h(){x.save(),x.setTransform(1,0,0,1,0,0),x.clearRect(0,0,canvas.width,canvas.height),x.restore()}function r(){if(x.globalCompositeOperation="source-over",1==E?x.globalAlpha=1:x.globalAlpha=.2,L>=100?L=0:L+=.3,a(),0!=b.hover&&"point"==b.type?(m[b.id].hoverPaint(),s(v)):s(v),1!=E){0!=b.hover&&"line"==b.type&&p[b.id].hoverPaint();for(var e=0;e<p.length;e++)p[e].paint(),g[e].paint(L)}else for(var e=0;e<p.length;e++)p[e].paint();t.requestAnimationFrame(r)}function l(t,e){for(var n=null,i=0;i<p.length;i++)p[i].isMouseInLine(t)&&(b.type="line",n=p[i].id,p[i].onHover(e));for(var i=0;i<m.length;i++)m[i].isMouseInPoint(t)&&(b.type="point",m[i].onHover(e),n=i);null!=n?(b.hover=!0,b.id=n,y.style.cursor="pointer"):(T.style.display="none",b.hover=!1,b.id=null,b.type="",y.style.cursor=B||"default")}function c(e){e.addEventListener("mousemove",function(t){var n={x:t.clientX-e.getBoundingClientRect().left,y:t.clientY-e.getBoundingClientRect().top};l(n,t)},!1),e.addEventListener("mousedown",function(t){function n(t,e,n){return{x:t.x-e,y:t.y-n}}for(var i={x:t.clientX-e.getBoundingClientRect().left,y:t.clientY-e.getBoundingClientRect().top},o=n(i,I.x,I.y),s=[],r=[],l=0;l<p.length;l++){var c=n(i,p[l].x1,p[l].y1),u=n(i,p[l].x2,p[l].y2),x={x1:c.x,y1:c.y,x2:u.x,y2:u.y};s.push(x)}for(var l=0;l<m.length;l++){var f=n(i,m[l].x,m[l].y),d={x:f.x,y:f.y};r.push(d)}B="move",y.style.cursor=B,E=!0,e.addEventListener("mousemove",function(t){var n={x:t.clientX-e.getBoundingClientRect().left,y:t.clientY-e.getBoundingClientRect().top};if(1==E){I.x=n.x-o.x,I.y=n.y-o.y;for(var i=0;i<p.length;i++){var l={x1:n.x-s[i].x1,y1:n.y-s[i].y1,x2:n.x-s[i].x2,y2:n.y-s[i].y2};p[i].change(l)}for(var i=0;i<m.length;i++){var l={x:n.x-r[i].x,y:n.y-r[i].y};m[i].change(l)}h(),a();for(var i=0;i<p.length;i++)p[i].paint();for(var i=0;i<m.length;i++)m[i].paint(3)}},!1),e.addEventListener("mouseup",function(t){B="default",y.style.cursor=B,E=!1},!1),t.preventDefault()},!1),e.addEventListener("mousewheel",function(e){e=e||t.event;var n=e.wheelDelta;n>0?9>=k&&u(1.25):k>=-9&&u(.8)},!1)}function u(e,n){e>1?k+=1:k-=1,n=n||t.event;for(var i={x:n.clientX-canvas.getBoundingClientRect().left,y:n.clientY-canvas.getBoundingClientRect().top},o={x:i.x-I.x,y:i.y-I.y},s={x:(1-e)*o.x,y:(1-e)*o.y},r=I.x+s.x,l=I.y+s.y,c=0;c<p.length;c++){var u={x1:e*(p[c].x1-I.x)+r,y1:e*(p[c].y1-I.y)+l,x2:e*(p[c].x2-I.x)+r,y2:e*(p[c].y2-I.y)+l};p[c].change(u)}for(var c=0;c<m.length;c++){var y={x:e*(m[c].x-I.x)+r,y:e*(m[c].y-I.y)+l};m[c].change(y)}I.x=r,I.y=l,f=e*f,d=e*d,h(),a()}var y,x,f,d,v,g=[],p=[],m=[],w=0,P=0,C=0,L=0,A="",E="false",B="default",b={hover:!1,type:"",id:null},k=0,I={x:0,y:0},M=document.createElement("div");M.id="mk-info",M.style.display="none",document.body.appendChild(M);var T=document.getElementById("mk-info"),R=document.createElement("canvas"),F=R.getContext("2d");R.width=100,R.height=100,F.beginPath(),F.arc(50,50,50,0,2*Math.PI),F.fillStyle="rgba(255,255,255,1)",F.fill();var X=document.createElement("canvas"),Y=X.getContext("2d");X.width=100,X.height=100,Y.beginPath(),Y.fillStyle="#000",Y.fillRect(0,0,100,100),Y.fill(),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var e=["webkit","moz"],n=0;n<e.length&&!t.requestnFrame;++n){var i=e[n];t.requestAnimationFrame=t[i+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i+"CancelAnimationFrame"]||t[i+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(t.navigator.userAgent)||!t.requestAnimationFrame||!t.cancelAnimationFrame){var o=0;t.requestAnimationFrame=function(t){var e=Date.now(),n=Math.max(o+16,e);return setTimeout(function(){t(o=n)},n-e)},t.cancelAnimationFrame=clearTimeout}}();var q=function(t,e,n){this.id=t,this.canvas=n,this.ctx=n.getContext("2d"),this.x1=e.from.x,this.y1=e.from.y,this.x2=e.to.x,this.y2=e.to.y,this.style=e.style||"#fff",this.info=e.info||"",this.init(),p[w]=this,w++,this.createBall()};q.prototype={init:function(){var t=o(this.x1,this.y1,this.x2,this.y2);this.cx=t.x,this.cy=t.y,this.angle=n(this.cx,this.cy,this.x2,this.y2),this.path=document.createElementNS("http://www.w3.org/2000/svg","path"),this.path.setAttribute("d","M"+this.x1+" "+this.y1+" Q"+this.cx+" "+this.cy+" "+this.x2+" "+this.y2),this.len=this.path.getTotalLength()},paint:function(){var t=this.ctx;t.beginPath(),this.draw(1),t.strokeStyle=this.style,t.stroke(),i(t,this.x2,this.y2,this.angle,20,10,this.style)},onHover:function(e){T.innerHTML="";for(var n=0;n<this.info.length;n++){var i=document.createElement("div"),o=document.createTextNode(this.info[n]);i.appendChild(o),T.appendChild(i)}var a=e.clientX,s=e.clientY;e.clientX+200>t.innerWidth?a=e.clientX-150:e.clientY+200>t.innerHeight&&(s=e.clientY-200),T.style.top=s+"px",T.style.left=a+20+"px",T.style.display="block"},draw:function(t){var e=this.ctx;e.moveTo(this.x1,this.y1),e.quadraticCurveTo(this.cx,this.cy,this.x2,this.y2),e.lineWidth=t,e.lineCap="round"},isMouseInLine:function(t){return this.ctx.beginPath(),this.draw(10),this.ctx.isPointInStroke(t.x,t.y)},pointAt:function(t){return this.px=this.path.getPointAtLength(this.len*t).x,this.py=this.path.getPointAtLength(this.len*t).y,this.path.getPointAtLength(this.len*t)},change:function(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this.init(),this.changeBall()},hoverPaint:function(){var t=this.ctx;t.beginPath(),this.draw(6),t.strokeStyle=this.style,t.stroke(),i(t,this.x2,this.y2,this.angle,20,10,this.style)},createBall:function(){var t={ctx:this.ctx,x1:this.x1,y1:this.y1,path:this.path,len:this.len,style:this.style};new H(this.id,t)},changeBall:function(){g[this.id].change(this.x1,this.y1,this.path,this.len)}};var H=function(t,e){this.ctx=e.ctx,this.x=e.x1,this.y=e.y1,this.path=e.path,this.len=e.len,this.style=e.style||"#fff",g[t]=this,P++};H.prototype={paint:function(t){var t=t/100;this.ctx;this.x=this.pointAt(t).x,this.y=this.pointAt(t).y,x.globalAlpha=.6,x.drawImage(R,this.x-2,this.y-2,4,4)},change:function(t,e,n,i){this.x=t,this.y=e,this.path=n,this.len=i},pointAt:function(t){return this.path.getPointAtLength(this.len*t)}};var S=function(t){this.x=t.x,this.y=t.y,this.info=t.info||"",this.style=t.style||"red",this.ctx=x,0==t.id?this.id=0:this.id=t.id||C,m[C]=this,C++};S.prototype={paint:function(t){var e=this.ctx;e.beginPath(),e.fillStyle=this.style,this.draw(t),e.fill()},onHover:function(e){T.innerHTML="";var n=document.createElement("div"),i=document.createTextNode(this.info);n.appendChild(i),T.appendChild(n);var o=e.clientX,a=e.clientY;e.clientX+200>t.innerWidth?o=e.clientX-150:e.clientY+200>t.innerHeight&&(a=e.clientY-200),T.style.top=a+"px",T.style.left=o+20+"px",T.style.display="block"},draw:function(t){var e=this.ctx;e.arc(this.x,this.y,t,0,2*Math.PI),e.closePath()},isMouseInPoint:function(t){return this.ctx.beginPath(),this.draw(5),this.ctx.isPointInPath(t.x,t.y)},change:function(t){this.x=t.x,this.y=t.y},hoverPaint:function(){this.paint(5)}};var D=function(t,e,n,i){var o=document.getElementById(t);return y=document.getElementById(t),A=e||"",null!=o?(markLine.prototype.id=t,x=o.getContext("2d"),markLine.prototype.ctx=o.getContext("2d"),f=n||o.width,d=i||o.height,new markLine.prototype.init(t)):void console.error("The canvas id is undefined.Check it.")};D.prototype={init:function(t){this.canvas=document.getElementById(t),c(this.canvas)},updateLine:function(t){if(p.length=0,g.length=0,w=0,P=0,0!=t.length)for(var e=0;e<t.length;e++)new q(e,t[e],this.canvas)},paint:function(){r()},paintPoint:function(t){if(m.length=0,C=0,v=0,0!=t.length){for(var e=0;e<t.length;e++)new S(t[e]);v=t.length}},onContextmenu:function(t){this.canvas.addEventListener("contextmenu",t,!1)},onClick:function(e){var n=this.canvas;n.addEventListener("mousedown",function(i){var i=i||t.event;return 1!=i.which?void n.removeEventListener("mouseup",e,!1):void n.addEventListener("mouseup",e,!1)},!1)},setOption:function(t){this.updateLine(t)},getLines:function(){return p},getLine:function(t){return p[t]},getBalls:function(){return g},getBall:function(t){return g[t]},getPoint:function(t){return m[t]},getPoints:function(){return m},getTransInfo:function(){return{x:I.x,y:I.y,scale:k}},getHover:function(){return b}},D.prototype.init.prototype=D.prototype,t.markLine=D}(window);